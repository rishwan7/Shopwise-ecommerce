<!DOCTYPE html>
<html lang="en">
<head>
<!-- Meta -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="Anil z" name="author">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Shopwise is Powerful features and You Can Use The Perfect Build this Template For Any eCommerce Website. The template is built for sell Fashion Products, Shoes, Bags, Cosmetics, Clothes, Sunglasses, Furniture, Kids Products, Electronics, Stationery Products and Sporting Goods.">
<meta name="keywords" content="ecommerce, electronics store, Fashion store, furniture store,  bootstrap 4, clean, minimal, modern, online store, responsive, retail, shopping, ecommerce store">

<!-- SITE TITLE -->
<title>Shopwise </title>
<!-- Favicon Icon -->
<link rel="shortcut icon" type="image/x-icon" href="/assets/images/favicon.png">
<!-- Animation CSS -->
<link rel="stylesheet" href="/assets/css/animate.css">	
<!-- Latest Bootstrap min CSS -->
<link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css">
<!-- Google Font -->
<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900&amp;display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800,900&amp;display=swap" rel="stylesheet"> 
<!-- Icon Font CSS -->
<link rel="stylesheet" href="/assets/css/all.min.css">
<link rel="stylesheet" href="/assets/css/ionicons.min.css">
<link rel="stylesheet" href="/assets/css/themify-icons.css">
<link rel="stylesheet" href="/assets/css/linearicons.css">
<link rel="stylesheet" href="/assets/css/flaticon.css">
<link rel="stylesheet" href="/assets/css/simple-line-icons.css">
<!--- owl carousel CSS-->
<link rel="stylesheet" href="/assets/owlcarousel/css/owl.carousel.min.css">
<link rel="stylesheet" href="/assets/owlcarousel/css/owl.theme.css">
<link rel="stylesheet" href="/assets/owlcarousel/css/owl.theme.default.min.css">
<!-- Magnific Popup CSS -->
<link rel="stylesheet" href="/assets/css/magnific-popup.css">
<!-- jquery-ui CSS -->
<link rel="stylesheet" href="/assets/css/jquery-ui.css">
<!-- Slick CSS -->
<link rel="stylesheet" href="/assets/css/slick.css">
<link rel="stylesheet" href="/assets/css/slick-theme.css">
<!-- Style CSS -->
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/responsive.css">

<!-- noUiSlide---------------------------------------------------------------------------------------------- -->



<link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.css" rel="stylesheet">



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106310707-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
 gtag('config', 'UA-106310707-1', { 'anonymize_ip': true });
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G6MPNF0KNC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-G6MPNF0KNC');
</script>




<!-- Hotjar Tracking Code for bestwebcreator.com -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:2073024,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>



</head>

<body>

<!-- LOADER -->
<div class="preloader">
    <div class="lds-ellipsis">
        <span></span>
        <span></span>
        <span></span>
    </div>
</div>
<!-- END LOADER -->

<<%- include('../layout/header') %>
<!-- START SECTION BREADCRUMB -->
<div class="breadcrumb_section bg_gray page-title-mini">
    <div class="container"><!-- STRART CONTAINER -->
        <div class="row align-items-center">
        	<div class="col-md-6">
                <div class="page-title">
            		<h1>Shop Left Sidebar</h1>
                </div>
            </div>
          
        </div>
    </div><!-- END CONTAINER-->
</div>
<!-- END SECTION BREADCRUMB -->

<!-- START MAIN CONTENT -->
<div class="main_content">

<!-- START SECTION SHOP -->
<div class="section">
	<div class="container">
    	<div class="row">
			<div class="col-lg-9">
            	<div class="row align-items-center mb-4 pb-1">
                    <div class="col-12">
                        <div class="product_header">
                            
                            <div class="product_header_right">
                            	<div class="products_view">
                                    <a href="javascript:;" class="shorting_icon grid active"><i class="ti-view-grid"></i></a>
                                    <a href="javascript:;" class="shorting_icon list"><i class="ti-layout-list-thumb"></i></a>
                                </div>
                               
                            </div>
                        </div>
                    </div>
                </div> 

              
                 
        
                <div class="row shop_container">
                    <% products.forEach(product => { %>
                  
                    <div class="col-md-4 col-6">
                     
                        <div class="product">
                            <div class="product_img">
                                <a href="shop-product-detail.html">
                                    <img src="/productImage/<%= product.productImage[0] %>" alt="<%= product.productName %>">
                                </a>
                                <div class="product_action_box">
                                    <ul class="list_none pr_action_btn">
                                        <li class="add-to-cart"><a href="#"><i class="icon-basket-loaded"></i> Add To Cart</a></li>
                                        <li><a href="shop-compare.html" class="popup-ajax"><i class="icon-shuffle"></i></a></li>
                                        <li><a href="shop-quick-view.html" class="popup-ajax"><i class="icon-magnifier-add"></i></a></li>
                                        <li><a href="#"><i class="icon-heart"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="product_info">
                                <h6 class="product_title"><a href="/productdetail/<%= product._id %>"><%= product.productName %></a></h6>
                                <div class="product_price">
                                    <span class="price">₹<%= product.offerPrice %> </span>
                                    <del>₹<%= product.productPrice %></del>
                                    <div class="on_sale">
                                        <span><%= product.percentageDifference %>% Off</span>
                                    </div>
                                </div>
                                <div class="rating_wrap">
                                    <div class="rating">
                                        <div class="product_rate" style="width:80%"></div>
                                    </div>
                                    <span class="rating_num"></span>
                                </div>
                                <div class="pr_desc">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus blandit massa enim. Nullam id varius nunc id varius nunc.</p>
                                </div>
                                <div class="pr_switch_wrap">
                                    <div class="product_color_switch">
                                        <span class="active" data-color="#87554B"></span>
                                        <span data-color="#333333"></span>
                                        <span data-color="#DA323F"></span>
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                       
                    </div>
                    <% }) %>
                   </div> 
                   <div class="row">
                    <div class="col-12">
                      <ul class="pagination mt-3 justify-content-center pagination_style1">
                        <% if (currentPage > 1) { %>
                          <li class="page-item"><a class="page-link" href="?page=<%= currentPage - 1 %>&category=<%= categoryId %>"><i class="linearicons-arrow-left"></i></a></li>
                        <% } %>
                        <% for (let i = 1; i <= totalPages; i++) { %>
                          <li class="page-item <%= currentPage === i ? 'active' : '' %>"><a class="page-link" href="?page=<%= i %>&category=<%= categoryId %>"><%= i %></a></li>
                        <% } %>
                        <% if (currentPage < totalPages) { %>
                          <li class="page-item"><a class="page-link" href="?page=<%= currentPage + 1 %>&category=<%= categoryId %>"><i class="linearicons-arrow-right"></i></a></li>
                        <% } %>
                      </ul>
                    </div>
                  </div>


                
        	</div>

            <div class="col-lg-3 order-lg-first mt-4 pt-2 mt-lg-0 pt-lg-0">
            	<div class="sidebar">
                    
                    <div class="widget">
                        <h5 class="widget_title">Filter</h5>
                        <div class="filter_price">
                            <div id="price_filter" 
                                 data-min="100" 
                                 data-max="200000" 
                               
                                 data-price-sign="₹"></div>
                            <div class="price_range">
                                <span>Price: <span id="flt_price"></span></span>
                            </div>
                        </div>
                    </div>
                    


                  

                    <div class="widget">
                        <h5 class="widget_title">Products</h5>
                        <% subcategories.forEach(subcategory => { %>
                          <div class="product_size_switch">
                            <input type="checkbox" class="subcategory-checkbox" id="subcategory-<%= subcategory._id %>" onclick="handleCheckboxClick('<%= subcategory._id %>')"> <%= subcategory.subcategoryName %>
                          </div>
                        <% }) %>
                      </div>
                   
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END SECTION SHOP -->

<!-- START SECTION SUBSCRIBE NEWSLETTER -->
<div class="section bg_default small_pt small_pb">
	<div class="container">	
    	<div class="row align-items-center">	
            <div class="col-md-6">
                <div class="heading_s1 mb-md-0 heading_light">
                    <h3>Subscribe Our Newsletter</h3>
                </div>
            </div>
            <div class="col-md-6">
                <div class="newsletter_form">
                    <form>
                        <input type="text" required="" class="form-control rounded-0" placeholder="Enter Email Address">
                        <button type="submit" class="btn btn-dark rounded-0" name="submit" value="Submit">Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- START SECTION SUBSCRIBE NEWSLETTER -->

</div>
<!-- END MAIN CONTENT -->

<%- include('../layout/footer') %>

<script>
 
 let selectedSubcategories = [];

async function handleCheckboxClick(subcategoryId) {
  const checkbox = document.getElementById(`subcategory-${subcategoryId}`);
  
  if (checkbox.checked) {
    selectedSubcategories.push(subcategoryId);
  } else {
    selectedSubcategories = selectedSubcategories.filter(id => id !== subcategoryId);
  }

  if (selectedSubcategories.length > 0) {
    await updateProducts(selectedSubcategories);
  } else {
    document.querySelector('.shop_container').innerHTML = '<p>No products to display. Please select a subcategory.</p>';
  }
}

async function updateProducts(subcategoryIds) {
  try {
    const response = await fetch("/subcategoryproduct", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ subcategoryIds })
    });

    const result = await response.json();

    if (result.success) {
      document.querySelector('.shop_container').innerHTML = '';
      result.products.forEach(product => {
        const productHTML = `
          <div class="col-md-4 col-6">
            <div class="product">
              <div class="product_img">
                <a href="shop-product-detail.html">
                  <img src="/productImage/${product.productImage[0]}" alt="${product.productName}">
                </a>
                <div class="product_action_box">
                  <ul class="list_none pr_action_btn">
                    <li class="add-to-cart"><a href="#"><i class="icon-basket-loaded"></i> Add To Cart</a></li>
                    <li><a href="shop-compare.html" class="popup-ajax"><i class="icon-shuffle"></i></a></li>
                    <li><a href="shop-quick-view.html" class="popup-ajax"><i class="icon-magnifier-add"></i></a></li>
                    <li><a href="#"><i class="icon-heart"></i></a></li>
                  </ul>
                </div>
              </div>
              <div class="product_info">
                <h6 class="product_title"><a href="/productdetail/${product._id}">${product.productName}</a></h6>
                <div class="product_price">
                  <span class="price">₹${product.offerPrice}</span>
                  <del>₹${product.productPrice}</del>
                  <div class="on_sale">
                    <span>${product.percentageDifference}% Off</span>
                  </div>
                </div>
                <div class="rating_wrap">
                  <div class="rating">
                    <div class="product_rate" style="width:80%"></div>
                  </div>
                  <span class="rating_num">(21)</span>
                </div>
                <div class="pr_desc">
                  <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus blandit massa enim. Nullam id varius nunc id varius nunc.</p>
                </div>
                <div class="pr_switch_wrap">
                  <div class="product_color_switch">
                    <span class="active" data-color="#87554B"></span>
                    <span data-color="#333333"></span>
                    <span data-color="#DA323F"></span>
                  </div>
                </div>
                <div class="list_product_action_box">
                  <ul class="list_none pr_action_btn">
                    <li class="add-to-cart"><a href="#"><i class="icon-basket-loaded"></i> Add To Cart</a></li>
                    <li><a href="shop-compare.html" class="popup-ajax"><i class="icon-shuffle"></i></a></li>
                    <li><a href="shop-quick-view.html" class="popup-ajax"><i class="icon-magnifier-add"></i></a></li>
                    <li><a href="#"><i class="icon-heart"></i></a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        `;

        document.querySelector('.shop_container').innerHTML += productHTML;
      });
    }
  } catch (error) {
    console.error('Error fetching subcategory products:', error);
  }
}


document.addEventListener('DOMContentLoaded', () => {
    const priceFilter = document.getElementById('price_filter');
    const fltPrice = document.getElementById('flt_price');
    const shopContainer = document.querySelector('.shop_container');

    // Initialize noUiSlider
    noUiSlider.create(priceFilter, {
        start: [100, 200000], // Initial values from data attributes
        connect: true,
        range: {
            'min': parseInt(priceFilter.getAttribute('data-min')),
            'max': parseInt(priceFilter.getAttribute('data-max'))
        }
    });

    // Function to update the displayed price range
    const updatePriceRange = (values, handle) => {
        const [minPrice, maxPrice] = values;
        fltPrice.textContent = `₹${minPrice} - ₹${maxPrice}`;
    };

    // Update price range display when slider value changes
    priceFilter.noUiSlider.on('update', updatePriceRange);

    // Fetch products based on selected price range
    priceFilter.noUiSlider.on('change', async (values, handle) => {
        const [minPrice, maxPrice] = values;

        try {
            const response = await fetch('/filter-by-price', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ minPrice, maxPrice })
            });

            const result = await response.json();

            if (result.success) {
                shopContainer.innerHTML = ''; // Clear existing products

                result.products.forEach(product => {
                    const productHTML = `
                        <div class="col-md-4 col-6">
                            <div class="product">
                                <div class="product_img">
                                    <a href="shop-product-detail.html">
                                        <img src="/productImage/${product.productImage[0]}" alt="${product.productName}">
                                    </a>
                                    <div class="product_action_box">
                                        <ul class="list_none pr_action_btn">
                                            <li class="add-to-cart"><a href="#"><i class="icon-basket-loaded"></i> Add To Cart</a></li>
                                            <li><a href="shop-compare.html" class="popup-ajax"><i class="icon-shuffle"></i></a></li>
                                            <li><a href="shop-quick-view.html" class="popup-ajax"><i class="icon-magnifier-add"></i></a></li>
                                            <li><a href="#"><i class="icon-heart"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="product_info">
                                    <h6 class="product_title"><a href="/productdetail/${product._id}">${product.productName}</a></h6>
                                    <div class="product_price">
                                        <span class="price">₹${product.offerPrice}</span>
                                        <del>₹${product.productPrice}</del>
                                        <div class="on_sale">
                                            <span>${product.percentageDifference}% Off</span>
                                        </div>
                                    </div>
                                    <div class="rating_wrap">
                                        <div class="rating">
                                            <div class="product_rate" style="width:80%"></div>
                                        </div>
                                        <span class="rating_num">(21)</span>
                                    </div>
                                    <div class="pr_desc">
                                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus blandit massa enim. Nullam id varius nunc id varius nunc.</p>
                                    </div>
                                    <div class="pr_switch_wrap">
                                        <div class="product_color_switch">
                                            <span class="active" data-color="#87554B"></span>
                                            <span data-color="#333333"></span>
                                            <span data-color="#DA323F"></span>
                                        </div>
                                    </div>
                                    <div class="list_product_action_box">
                                        <ul class="list_none pr_action_btn">
                                            <li class="add-to-cart"><a href="#"><i class="icon-basket-loaded"></i> Add To Cart</a></li>
                                            <li><a href="shop-compare.html" class="popup-ajax"><i class="icon-shuffle"></i></a></li>
                                            <li><a href="shop-quick-view.html" class="popup-ajax"><i class="icon-magnifier-add"></i></a></li>
                                            <li><a href="#"><i class="icon-heart"></i></a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    shopContainer.innerHTML += productHTML;
                });

            } else {
                console.error('Failed to fetch products:', result.message);
            }
        } catch (error) {
            console.error('Error fetching products:', error);
        }
    });
});


</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.7.0/nouislider.min.js"></script>

<!-- Latest jQuery --> 
<script src="/assets/js/jquery-3.7.0.min.js"></script> 
<!-- jquery-ui --> 
<script src="/assets/js/jquery-ui.js"></script>
<!-- popper min js -->
<script src="/assets/js/popper.min.js"></script>
<!-- Latest compiled and minified Bootstrap --> 
<script src="/assets/bootstrap/js/bootstrap.min.js"></script> 
<!-- owl-carousel min js  --> 
<script src="/assets/owlcarousel/js/owl.carousel.min.js"></script> 
<!-- magnific-popup min js  --> 
<script src="/assets/js/magnific-popup.min.js"></script> 
<!-- waypoints min js  --> 
<script src="/assets/js/waypoints.min.js"></script> 
<!-- parallax js  --> 
<script src="/assets/js/parallax.js"></script> 
<!-- countdown js  --> 
<script src="/assets/js/jquery.countdown.min.js"></script> 
<!-- imagesloaded js --> 
<script src="/assets/js/imagesloaded.pkgd.min.js"></script>
<!-- isotope min js --> 
<script src="/assets/js/isotope.min.js"></script>
<!-- jquery.dd.min js -->
<script src="/assets/js/jquery.dd.min.js"></script>
<!-- slick js -->
<script src="/assets/js/slick.min.js"></script>
<!-- elevatezoom js -->
<script src="/assets/js/jquery.elevatezoom.js"></script>
<!-- scripts js --> 
<script src="/assets/js/scripts.js"></script>

</body>
</html>